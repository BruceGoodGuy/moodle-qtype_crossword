{"version":3,"file":"crossword.min.js","sources":["../src/crossword.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * JavaScript to make crossword question.\r\n *\r\n * @module qtype_crossword/crossword\r\n * @copyright 2022 The Open University\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport {CrosswordGrid} from 'qtype_crossword/crossword_grid';\r\n\r\n/**\r\n * Get list of words object from moodle form to display in the preview section.\r\n *\r\n * @return {array} List of the words object. E.g: {answer: PARIS, clue: sample clue, no: word number in the form}\r\n */\r\nconst getWordsFromForm = function() {\r\n    const alphaRegex = /^[a-z]+/;\r\n    const numberAnswer = document.querySelectorAll('[id^=\"fitem_id_answer\"]').length;\r\n    let words = [];\r\n\r\n    if (numberAnswer > 0) {\r\n        for (let no = 0; no < numberAnswer; no++) {\r\n            const coordinateEl = document.querySelector('#fgroup_id_coodinateoptions_' + no);\r\n            const answerEl = document.querySelector('#fitem_id_answer_' + no);\r\n            const clueEl = document.querySelector('#fitem_id_clue_' + no);\r\n            let word = {};\r\n            word.no = no + 1;\r\n\r\n            if (!coordinateEl || !answerEl || !clueEl) {\r\n                continue;\r\n            }\r\n\r\n            coordinateEl.querySelectorAll('select').forEach(selectEl => {\r\n                const name = selectEl.name.match(alphaRegex)?.pop();\r\n                word[name] = selectEl.selectedIndex;\r\n            });\r\n\r\n            word.answer = answerEl.querySelector('input[id^=\"id_answer\"]').value.normalize('NFKC');\r\n            let clueData = clueEl.querySelector('textarea[id^=\"id_clue_\"]').value.trim();\r\n            // If it is a HTML empty content, set clue to empty.\r\n            if (htmlIsEmpty(clueData)) {\r\n                clueData = '';\r\n            }\r\n            word.clue = clueData;\r\n            words.push(word);\r\n        }\r\n    }\r\n\r\n    return words;\r\n};\r\n\r\nconst EMPTY_EDITOR_CONTENT = [\r\n    // For FF and Chrome.\r\n    '<p></p>',\r\n    '<p><br></p>',\r\n    '<br>',\r\n    '<p dir=\"rtl\" style=\"text-align: right;\"></p>',\r\n    '<p dir=\"rtl\" style=\"text-align: right;\"><br></p>',\r\n    '<p dir=\"ltr\" style=\"text-align: left;\"></p>',\r\n    '<p dir=\"ltr\" style=\"text-align: left;\"><br></p>',\r\n    // For IE 9 and 10.\r\n    '<p>&nbsp;</p>',\r\n    '<p><br>&nbsp;</p>',\r\n    '<p dir=\"rtl\" style=\"text-align: right;\">&nbsp;</p>',\r\n    '<p dir=\"rtl\" style=\"text-align: right;\"><br>&nbsp;</p>',\r\n    '<p dir=\"ltr\" style=\"text-align: left;\">&nbsp;</p>',\r\n    '<p dir=\"ltr\" style=\"text-align: left;\"><br>&nbsp;</p>'\r\n];\r\n\r\n/**\r\n * Check the HTML content is empty or not.\r\n *\r\n * @param {String} htmlContent HTML content include tags. E.g: <p>Sample html</p>\r\n * @return {boolean} return true if HTML content is consider empty.\r\n */\r\nexport const htmlIsEmpty = (htmlContent) => {\r\n    return EMPTY_EDITOR_CONTENT.includes(htmlContent);\r\n};\r\n\r\n/**\r\n * Handle action attempt crossword.\r\n *\r\n * @param {Object} options The crossword settings.\r\n */\r\nexport const attempt = (options) => {\r\n    const crossword = new CrosswordGrid(options);\r\n    crossword.buildCrossword();\r\n};\r\n\r\n/**\r\n * Handle action preview crossword.'\r\n *\r\n * @param {Object} options The crossword settings.\r\n */\r\nexport const preview = (options) => {\r\n    const element = document.querySelector(options.element);\r\n    if (element) {\r\n        element.removeAttribute('disabled');\r\n        element.addEventListener('click', function(event) {\r\n            event.preventDefault();\r\n            const columnEl = document.querySelector('select[name=\"numcolumns\"]');\r\n            const rowEl = document.querySelector('select[name=\"numrows\"]');\r\n            const words = getWordsFromForm(options.target);\r\n            const settings = {...options,\r\n                words,\r\n                colsNum: columnEl.options[columnEl.selectedIndex].text,\r\n                rowsNum: rowEl.options[rowEl.selectedIndex].text\r\n            };\r\n            const crossword = new CrosswordGrid(settings);\r\n            crossword.previewCrossword();\r\n        });\r\n    }\r\n};\r\n"],"names":["EMPTY_EDITOR_CONTENT","htmlIsEmpty","htmlContent","includes","options","CrosswordGrid","buildCrossword","element","document","querySelector","removeAttribute","addEventListener","event","preventDefault","columnEl","rowEl","words","alphaRegex","numberAnswer","querySelectorAll","length","no","coordinateEl","answerEl","clueEl","word","forEach","selectEl","name","match","_selectEl$name$match","pop","selectedIndex","answer","value","normalize","clueData","trim","clue","push","getWordsFromForm","target","settings","colsNum","text","rowsNum","previewCrossword"],"mappings":";;;;;;;;MAiEMA,qBAAuB,CAEzB,UACA,cACA,OACA,+CACA,mDACA,8CACA,kDAEA,gBACA,oBACA,qDACA,yDACA,oDACA,yDASSC,YAAeC,aACjBF,qBAAqBG,SAASD,+DAQjBE,UACF,IAAIC,8BAAcD,SAC1BE,mCAQUF,gBACdG,QAAUC,SAASC,cAAcL,QAAQG,SAC3CA,UACAA,QAAQG,gBAAgB,YACxBH,QAAQI,iBAAiB,SAAS,SAASC,OACvCA,MAAMC,uBACAC,SAAWN,SAASC,cAAc,6BAClCM,MAAQP,SAASC,cAAc,0BAC/BO,MAvFO,iBACfC,WAAa,UACbC,aAAeV,SAASW,iBAAiB,2BAA2BC,WACtEJ,MAAQ,MAERE,aAAe,MACV,IAAIG,GAAK,EAAGA,GAAKH,aAAcG,KAAM,OAChCC,aAAed,SAASC,cAAc,+BAAiCY,IACvEE,SAAWf,SAASC,cAAc,oBAAsBY,IACxDG,OAAShB,SAASC,cAAc,kBAAoBY,QACtDI,KAAO,MACXA,KAAKJ,GAAKA,GAAK,GAEVC,eAAiBC,WAAaC,gBAInCF,aAAaH,iBAAiB,UAAUO,SAAQC,0CACtCC,kCAAOD,SAASC,KAAKC,MAAMZ,mDAApBa,qBAAiCC,MAC9CN,KAAKG,MAAQD,SAASK,iBAG1BP,KAAKQ,OAASV,SAASd,cAAc,0BAA0ByB,MAAMC,UAAU,YAC3EC,SAAWZ,OAAOf,cAAc,4BAA4ByB,MAAMG,OAElEpC,YAAYmC,YACZA,SAAW,IAEfX,KAAKa,KAAOF,SACZpB,MAAMuB,KAAKd,aAIZT,MAsDewB,CAAiBpC,QAAQqC,QACjCC,SAAW,IAAItC,QACjBY,MAAAA,MACA2B,QAAS7B,SAASV,QAAQU,SAASkB,eAAeY,KAClDC,QAAS9B,MAAMX,QAAQW,MAAMiB,eAAeY,MAE9B,IAAIvC,8BAAcqC,UAC1BI"}